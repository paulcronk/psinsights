import pandas as pd
from psinsights import Service

"""
This script is set up to check a sample of 124 pages selected to represent a sample of pages that are not so easy to differentiate in GA
For those pages it takes metrics for pageviews and load times (3 types) and the pagespeed sample size, and this script adds the associated
PageSpeed metrics.
First run for 1-30 Nov GAmetrics and on 31 Dec for PageSpeed.
"""

# my Google API key
service = Service('AIzaSyA3FfXgcx1LF5wLNUjVrFB9ioJ8cQrRgkM')
# list of URLs
# url = pd.read_csv('pagespeed-pages.csv', encoding='utf-8')

url = [['https://www.gov.uk/government/get-involved/take-part/national-citizen-service','Take part','5138','2.433181818','1.888666667','0.054181818','33'] ,['https://www.gov.uk/government/get-involved/take-part/volunteer','Take part','2296','3.701652174','2.854869565','0.151521739','23'] ,['https://www.gov.uk/government/get-involved/take-part/volunteer-as-a-school-governor','Take part','1402','4.882769231','4.090615385','0.173307692','13'] ,['https://www.gov.uk/government/get-involved/take-part/become-a-councillor','Take part','1303','2.7287','2.3101','0.0145','10'] ,['https://www.gov.uk/government/get-involved/take-part/help-run-a-charity','Take part','864','1.420727273','0.977','0.068454545','11'] ,['https://www.gov.uk/government/fields-of-operation/afghanistan','Fields of operation','1783','5.359636364','4.315363636','0.374909091','11'] ,['https://www.gov.uk/government/fields-of-operation/iraq','Fields of operation','209','1.889','1.578666667','0.017333333','3'] ,['https://www.gov.uk/government/ministers/secretary-of-state-for-education','Ministers','3162','2.761384615','1.731025641','0.022974359','39'] ,['https://www.gov.uk/government/ministers/prime-minister','Ministers','3042','3.198333333','1.970666667','0.010333333','24'] ,['https://www.gov.uk/government/ministers/secretary-of-state-for-health','Ministers','2656','2.266454545','1.636318182','0.004681818','22'] ,['https://www.gov.uk/government/ministers/chancellor-of-the-exchequer','Ministers','2375','2.013380952','1.305238095','0.068714286','21'] ,['https://www.gov.uk/government/ministers/secretary-of-state-for-defence','Ministers','2372','2.71285','2.1728','0.0296','20'] ,['https://www.gov.uk/government/statistical-data-sets/unclaimed-estates-list','Statistical data sets','20807','2.888173469','1.744285714','0.060887755','98'] ,['https://www.gov.uk/government/statistical-data-sets/price-paid-data-downloads','Statistical data sets','5581','6.652797297','6.338013514','0.011878378','74'] ,['https://www.gov.uk/government/statistical-data-sets/car-theory-test-data-by-test-centre','Statistical data sets','5154','5.642030303','3.510030303','0.067242424','33'] ,['https://www.gov.uk/government/statistical-data-sets/ofsted-parent-view-management-information','Statistical data sets','4616','2.433038462','1.726307692','0.1065','26'] ,['https://www.gov.uk/government/statistical-data-sets/annual-domestic-energy-price-statistics','Statistical data sets','4177','3.857382353','2.994147059','0.048764706','34'] ,['https://www.gov.uk/government/statistics/announcements','Statistical announcements','34175','1.924086207','1.466286207','0.452441379','290'] ,['https://www.gov.uk/government/statistics/announcements/uk-business-activity-size-and-location-2015','Statistical announcements','230','0.62175','0.40075','0.01375','4'] ,['https://www.gov.uk/government/statistics/announcements/causes-of-deaths-among-uk-armed-forces-veterans-of-the-1982-falklands-campaign','Statistical announcements','195','0.295','0.178','0.002','1'] ,['https://www.gov.uk/government/statistics/announcements/football-related-arrests-and-banning-orders-season-2014-to-2015','Statistical announcements','175','0','0','0','0'] ,['https://www.gov.uk/government/statistics/announcements/consumer-price-indices-october-2015','Statistical announcements','170','0','0','0','0'] ,['https://www.gov.uk/government/statistics/announcements/eyfsp-attainment-by-pupil-characteristics-england-2015','Statistical announcements','159','0','0','0','0'] ,['https://www.gov.uk/government/statistics/english-indices-of-deprivation-2015','Statistics','18813','1.837549223','1.102367876','0.019336788','193'] ,['https://www.gov.uk/government/statistics/early-years-foundation-stage-profile-results-2014-to-2015','Statistics','10308','1.265690141','0.785140845','0.013366197','71'] ,['https://www.gov.uk/government/statistics/prison-population-figures-2015','Statistics','8343','2.29680597','1.56880597','0.043820896','67'] ,['https://www.gov.uk/government/statistics/weekly-national-flu-reports','Statistics','6148','3.30377193','1.711263158','0.039210526','57'] ,['https://www.gov.uk/government/statistics/provisional-gcse-and-equivalent-results-in-england-2014-to-2015','Statistics','5555','1.201854545','0.858709091','0.016490909','55'] ,['https://www.gov.uk/government/statistics/disability-facts-and-figures','Statistics','5051','1.526','1.072984848','0.006606061','66'] ,['https://www.gov.uk/government/statistics/national-curriculum-assesments-at-key-stage-2-2015-provisional','Statistics','4872','1.450483871','1.131548387','0.017225806','31'] ,['https://www.gov.uk/government/statistics/national-diet-and-nutrition-survey-results-from-years-1-to-4-combined-of-the-rolling-programme-for-2008-and-2009-to-2011-and-2012','Statistics','4591','2.400625','1.444','0.03509375','32'] ,['https://www.gov.uk/government/statistics/statistics-on-race-and-the-criminal-justice-system-2012','Statistics','4234','1.957085714','1.474085714','0.015228571','35'] ,['https://www.gov.uk/government/statistics/an-overview-of-sexual-offending-in-england-and-wales','Statistics','4227','3.732232558','2.97555814','0.018395349','43'] ,['https://www.gov.uk/government/speeches/chancellor-george-osbornes-spending-review-and-autumn-statement-2015-speech','Speeches','33548','2.91594697','1.885253788','0.094185606','264'] ,['https://www.gov.uk/government/speeches/hmcis-monthly-commentary-november-2015','Speeches','14879','3.90994958','2.66194958','0.10689916','119'] ,['https://www.gov.uk/government/speeches/amber-rudds-speech-on-a-new-direction-for-uk-energy-policy','Speeches','13600','1.803967391','1.0235','0.034402174','92'] ,['https://www.gov.uk/government/speeches/nicky-morgan-one-nation-education','Speeches','9356','1.997109375','1.2638125','0.02840625','64'] ,['https://www.gov.uk/government/speeches/george-osborne-sets-out-his-priorities-for-the-spending-review','Speeches','8186','1.179','0.772962963','0.016888889','81'] ,['https://www.gov.uk/government/speeches/statement-on-junior-doctors-contract','Speeches','8151','4.122836364','3.499490909','0.053581818','55'] ,['https://www.gov.uk/government/speeches/chancellors-speech-to-gchq-on-cyber-security','Speeches','6579','2.202875','1.458035714','0.036089286','56'] ,['https://www.gov.uk/government/speeches/prisons-announcement','Speeches','5446','3.586','2.829577778','0.076177778','45'] ,['https://www.gov.uk/government/speeches/prime-ministers-speech-on-europe','Speeches','5409','3.359727273','1.658636364','0.106848485','33'] ,['https://www.gov.uk/government/speeches/hmcis-monthly-commentary-october-2015','Speeches','4265','5.48965','3.91035','0.0834','20'] ,['https://www.gov.uk/government/publications/child-benefit-claim-form-ch2','Publications','192270','2.371172566','1.481685841','0.050650442','1582'] ,['https://www.gov.uk/government/publications/application-to-naturalise-as-a-british-citizen-form-an','Publications','141952','1.90749134','1.027583029','0.033792883','1097'] ,['https://www.gov.uk/government/publications/paye-starter-checklist','Publications','134002','1.763506394','1.152026609','0.031460944','1173'] ,['https://www.gov.uk/government/publications/national-insurance-get-your-national-insurance-number-in-writing-ca5403','Publications','128629','1.956284264','1.411794297','0.07645723','985'] ,['https://www.gov.uk/government/publications/application-for-a-state-pension-statement','Publications','128283','1.473332367','1.0335706','0.045740812','1035'] ,['https://www.gov.uk/government/publications/spending-review-and-autumn-statement-2015-documents','Publications','125247','1.653483654','1.007223077','0.025116346','1040'] ,['https://www.gov.uk/government/publications/rates-of-vehicle-tax-v149','Publications','121201','1.986684507','1.53192286','0.058145814','1065'] ,['https://www.gov.uk/government/publications/guidance-on-applying-for-uk-visa-approved-english-language-tests','Publications','102284','1.524690588','1.049946934','0.04678066','850'] ,['https://www.gov.uk/government/publications/application-for-a-vehicle-registration-certificate','Publications','97652','1.580291855','1.105669683','0.038878959','884'] ,['https://www.gov.uk/government/publications/income-tax-tax-relief-for-expenses-of-employment-p87','Publications','97382','1.832805627','1.154417425','0.040089727','782'] ,['https://www.gov.uk/government/publications/self-assessment-tax-return-sa100','Publications','92483','1.585523388','0.824752212','0.042165613','791'] ,['https://www.gov.uk/government/publications/hmrc-exchange-rates-for-2015-monthly','Publications','79172','1.277317127','0.685503893','0.018972191','905'] ,['https://www.gov.uk/government/publications/statutory-sick-pay-employees-statement-of-sickness-sc2','Publications','79060','1.874459885','1.187373926','0.044010029','698'] ,['https://www.gov.uk/government/publications/fees-for-citizenship-applications','Publications','73828','1.501505376','1.067505376','0.073466974','651'] ,['https://www.gov.uk/government/publications/2016-key-stage-2-mathematics-sample-test-materials-mark-schemes-and-test-administration-instructions','Publications','73795','1.213462081','0.766361552','0.021460317','567'] ,['https://www.gov.uk/government/publications/national-living-wage-nlw/national-living-wage-nlw','Publications','68433','2.367394649','1.772270903','0.064011706','598'] ,['https://www.gov.uk/government/publications/national-security-strategy-and-strategic-defence-and-security-review-2015','Publications','60628','3.317297994','1.920209169','0.039063037','349'] ,['https://www.gov.uk/government/publications/2016-key-stage-1-english-grammar-punctuation-and-spelling-sample-test-materials-mark-scheme-and-test-administration-instructions','Publications','59063','1.015904382','0.521486974','0.009004008','502'] ,['https://www.gov.uk/government/publications/budgeting-loan-claim-form','Publications','59047','2.146441584','1.560972056','0.143847525','505'] ,['https://www.gov.uk/government/publications/car-show-me-tell-me-vehicle-safety-questions','Publications','56227','3.626805104','2.215556845','0.09462645','431'] ,['https://www.gov.uk/government/topical-events/autumn-statement-and-spending-review-2015','Topical events','222011','1.835801657','1.004662351','0.030812532','1931'] ,['https://www.gov.uk/government/topical-events/budget-july-2015','Topical events','17046','2.366791045','1.007126866','0.016335821','134'] ,['https://www.gov.uk/government/topical-events/autumn-statement-2014','Topical events','4333','2.2696','1.449177778','0.016755556','45'] ,['https://www.gov.uk/government/topical-events/isil-uk-government-response--3','Topical events','4152','3.248108108','1.955594595','0.064945946','37'] ,['https://www.gov.uk/government/topical-events/farming','Topical events','3617','1.194333333','0.797416667','0.014541667','24'] ,['https://www.gov.uk/government/topical-events/budget-2015','Topical events','3511','1.470227273','0.8795','0.009136364','44'] ,['https://www.gov.uk/government/world-location-news/senior-british-government-delegation-visits-cairo-for-discussions-on-a-joint-plan-to-restart-flights-to-sharm-el-sheikh','World location news','7048','2.930065217','2.365717391','0.048543478','46'] ,['https://www.gov.uk/government/world-location-news/changes-for-settlement-visa-applications-submitted-in-pakistan','World location news','3393','3.503173913','2.64073913','0.011086957','23'] ,['https://www.gov.uk/government/world-location-news/holy-year-of-mercy-italy-travel-advice','World location news','2770','1.52025','1.0978','0.01715','20'] ,['https://www.gov.uk/government/world-location-news/changes-to-secure-english-language-test-providers-for-uk-visas','World location news','2047','10.72779167','8.692583333','2.551875','24'] ,['https://www.gov.uk/government/world-location-news/information-for-british-nationals-in-sharm-el-sheikh','World location news','1956','2.69925','2.277666667','0.02675','12'] ,['https://www.gov.uk/government/world-location-news/qarabag-fk-v-tottenham-hotspur-travel-advice','World location news','1491','3.714388889','2.993222222','0.057555556','18'] ,['https://www.gov.uk/government/world-location-news/changes-to-the-visa-service-in-russia--2','World location news','805','0.980555556','0.676','0.010444444','9'] ,['https://www.gov.uk/government/world-location-news/passport-fees-for-british-nationals-overseas-reduced-by-35','World location news','742','3.8255','3.19275','0.14925','4'] ,['https://www.gov.uk/government/world-location-news/changes-to-the-uk-visa-application-process-in-ukraine','World location news','740','1.949666667','1.356333333','0.007','6'] ,['https://www.gov.uk/government/world-location-news/changes-to-visa-process-for-applicants-travelling-to-the-uk-for-more-than-6-months','World location news','730','1.7448','1.4222','0.0112','5'] ,['https://www.gov.uk/government/fatalities/flight-lieutenants-alan-scott-and-geraint-roberts-have-died','Fatalities','1325','1.573846154','1.181384615','0.162','13'] ,['https://www.gov.uk/government/fatalities/lance-corporal-michael-campbell-died-from-wounds-sustained-in-afghanistan','Fatalities','578','2.942','1.9635','0.00825','4'] ,['https://www.gov.uk/government/fatalities/lance-corporal-robert-martin-richards-rm-dies-of-wounds-sustained-in-helmand','Fatalities','531','2.156','1.886','0.0148','5'] ,['https://www.gov.uk/government/fatalities/corporal-liam-riley-and-lance-corporal-graham-shaw-killed-in-afghanistan','Fatalities','485','1.7696','1.5046','0.02','5'] ,['https://www.gov.uk/government/fatalities/rifleman-cyrus-thatcher-killed-in-afghanistan','Fatalities','471','4.983','3.189','0.038','1'] ,['https://www.gov.uk/government/collections/national-curriculum-assessments-2016-sample-materials','Collections','111911','1.458618579','0.922080874','0.015614208','915'] ,['https://www.gov.uk/government/collections/national-curriculum','Collections','109859','1.935978809','1.295587879','0.035672727','991'] ,['https://www.gov.uk/government/collections/business-e-services','Collections','106180','1.050482061','0.572036538','0.025524038','1087'] ,['https://www.gov.uk/government/collections/how-to-manually-check-your-payroll-calculations','Collections','98313','1.597236277','1.063649102','0.031501796','838'] ,['https://www.gov.uk/government/collections/fees-land-registry-guides','Collections','55087','1.252181818','0.844162933','0.01610387','495'] ,['https://www.gov.uk/government/collections/companies-house-forms-for-limited-companies','Collections','54567','1.127432692','0.808739806','0.014836893','520'] ,['https://www.gov.uk/government/collections/land-registry-forms','Collections','44959','1.531066869','1.193130898','0.023648402','658'] ,['https://www.gov.uk/government/collections/immunisation-against-infectious-disease-the-green-book','Collections','43354','1.497507246','0.87027451','0.044754902','207'] ,['https://www.gov.uk/government/collections/autumn-statement-2015-tax-related-documents','Collections','42007','0.872296736','0.585599407','0.032890208','337'] ,['https://www.gov.uk/government/collections/exchange-rates-for-customs-and-vat','Collections','41841','1.487938247','1.015996008','0.0169501','502'] ,['https://www.gov.uk/government/case-studies/intellectual-property-these-please','Case studies','614','0.8362','0.4718','0.0132','5'] ,['https://www.gov.uk/government/case-studies/gls-lawyers-discuss-their-experiences-as-legal-trainees','Case studies','488','3.805444444','0.886777778','0.036222222','9'] ,['https://www.gov.uk/government/case-studies/now-we-have-a-warm-house-and-are-using-less-gas-thanks-to-external-wall-insulation','Case studies','449','1.78625','1.25775','0.00525','4'] ,['https://www.gov.uk/government/case-studies/the-expert-patients-programme','Case studies','407','3.684','1.397','0.002','1'] ,['https://www.gov.uk/government/case-studies/whole-school-approach-managing-poor-behaviour','Case studies','312','0.776333333','0.571','0.02','3'] ,['https://www.gov.uk/government/case-studies/gypsy-roma-and-traveller-pupils-supporting-access-to-education','Case studies','292','3.385','1.5475','0.0045','2'] ,['https://www.gov.uk/government/case-studies/marks-spencer-recruiting-women-from-different-backgrounds','Case studies','285','19.272','16.02725','0.02825','4'] ,['https://www.gov.uk/government/case-studies/led-sleep-mask-tackles-causes-of-sight-loss','Case studies','268','10.2212','1.5522','0.0412','5'] ,['https://www.gov.uk/government/case-studies/clever-engineering-macrete-bridges-the-technology-gap','Case studies','249','1.29125','0.41425','0.0045','4'] ,['https://www.gov.uk/government/case-studies/competition-law-case-studies','Case studies','249','1.2195','0.262','0.02','2'] ,['https://www.gov.uk/government/publications/car-show-me-tell-me-vehicle-safety-questions/car-show-me-tell-me-vehicle-safety-questions','HTML publications','101058','9.024347541','1.706163934','0.06367541','610'] ,['https://www.gov.uk/government/publications/national-living-wage-nlw/national-living-wage-nlw','HTML publications','68433','2.367394649','1.772270903','0.064011706','598'] ,['https://www.gov.uk/government/publications/tax-and-tax-credit-rates-and-thresholds-for-2015-16/tax-and-tax-credit-rates-and-thresholds-for-2015-16','HTML publications','67523','3.329245081','2.013332737','0.037454383','559'] ,['https://www.gov.uk/government/publications/spending-review-and-autumn-statement-2015-documents/spending-review-and-autumn-statement-2015','HTML publications','63203','5.481497436','2.485005128','0.403095726','585'] ,['https://www.gov.uk/government/publications/rates-and-allowances-national-insurance-contributions/rates-and-allowances-national-insurance-contributions','HTML publications','50594','1.702521277','1.010110874','0.034276596','470'] ,['https://www.gov.uk/government/publications/rates-and-allowances-income-tax/income-tax-rates-and-allowances-current-and-past','HTML publications','48124','1.767281013','1.170767089','0.063235443','395'] ,['https://www.gov.uk/government/publications/recognising-the-terrorist-threat/recognising-the-terrorist-threat','HTML publications','42330','2.331368243','1.513064189','0.0495','296'] ,['https://www.gov.uk/government/publications/rates-and-allowances-travel-mileage-and-fuel-allowances/travel-mileage-and-fuel-rates-and-allowances','HTML publications','39701','1.03183432','0.707691395','0.022192878','338'] ,['https://www.gov.uk/government/publications/advisory-fuel-rates/advisory-fuel-rates-from-1-september-2015','HTML publications','38601','1.099342466','0.674994475','0.05789779','365'] ,['https://www.gov.uk/government/publications/safeguarding-children-and-young-people/safeguarding-children-and-young-people','HTML publications','36974','2.9832397','2.072181132','0.040154717','267'] ,['https://www.gov.uk/government/publications/financial-sanctions-consolidated-list-of-targets/consolidated-list-of-targets','HTML publications','34524','0.969147059','0.61220944','0.013265487','340'] ,['https://www.gov.uk/government/publications/tax-and-tax-credit-rates-and-thresholds-for-2014-15/tax-and-tax-credit-rates-and-thresholds-for-2014-15','HTML publications','30806','2.353987903','1.633822581','0.028645161','248'] ,['https://www.gov.uk/government/publications/rates-and-allowances-stamp-duty-land-tax/stamp-duty-land-tax-rates','HTML publications','28943','8.465043478','6.122490909','0.033581818','276'] ,['https://www.gov.uk/government/publications/tax-credits-entitlement-table-working-at-least-16-hours-and-no-childcare/tax-credits-entitlement-table-working-at-least-16-hours-and-no-childcare','HTML publications','28258','1.776545024','1.357895735','0.070317536','211'] ,['https://www.gov.uk/government/publications/vat-notice-733-flat-rate-scheme-for-small-businesses/vat-notice-733-flat-rate-scheme-for-small-businesses','HTML publications','25451','1.850355556','1.010352679','0.158209821','225'] ,['https://www.gov.uk/government/publications/vat-notice-708-buildings-and-construction/vat-notice-708-buildings-and-construction','HTML publications','25216','2.078335052','1.405533679','0.183917098','194'] ,['https://www.gov.uk/government/publications/genuine-hmrc-contact-and-recognising-phishing-emails/genuine-hmrc-contact-and-recognising-phishing-emails','HTML publications','21768','1.398508772','1.040608187','0.041555556','171'] ,['https://www.gov.uk/government/publications/civil-service-generalist-fast-stream/fast-stream-diplomatic-service','HTML publications','21637','6.769768212','2.111456954','0.022596026','151'] ,['https://www.gov.uk/government/publications/professional-bodies-approved-for-tax-relief-list-3/approved-professional-organisations-and-learned-societies','HTML publications','21343','2.604775758','1.064975758','0.208490909','165'] ,['https://www.gov.uk/government/publications/national-curriculum-in-england-mathematics-programmes-of-study/national-curriculum-in-england-mathematics-programmes-of-study','HTML publications','21124','2.74698324','1.656631285','0.089117318','179']]
# define dataframe
headings = ['URL', 'Format', 'Pageviews', 'Page load time', 'Interactive doc time', 'Download time', 'Sample size', 'Title', 'PageSpeed score', 'Total Resource count', 'Total Request Bytes', 'Static Resource count', 'CSS Resource count', 'CSS Response Bytes', 'Flash Response Bytes', 'Host Count', 'HTML Response Bytes', 'Image Response Bytes', 'JavaScript Resource Count', 'JavaScript Response Bytes', 'Text Response Bytes', 'Other Response Bytes']
table = []
speed = pd.DataFrame(columns=headings, data=table)

# loop through each url
for page in url:
    analysis = service.analyze(page[0])
    stats = analysis.statistics
    # get data into list
    newrow = [page[0], page[1], page[2], page[3], page[4], page[5], page[6],analysis.title, analysis.score, stats.resource_count,
     stats.total_request_bytes, stats.static_resource_count,
     stats.css_resource_count, stats.css_response_bytes,
     stats.flash_response_bytes, stats.host_count,
     stats.html_response_bytes, stats.image_response_bytes,
     stats.javascript_resource_count,
     stats.javascript_response_bytes, stats.text_response_bytes,
     stats.other_response_bytes]
    # turn data list  into dataframe
    newrowdf = pd.Series(newrow, index=headings)
    # append dataframe to main dataframe
    speed = speed.append(newrowdf, ignore_index=True)

print speed
speed.to_csv('pagespeed-results.csv',encoding='utf-8')
